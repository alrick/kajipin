<% content_for :page_title do %><%= @user.first_name %>'s Worldmap<% end %>

<script type="text/javascript">

  var map = new L.Map('map', {
    maxZoom: 18,
    minZoom: 3
  });

  var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/998/256/{z}/{x}/{y}.png',
    cloudmadeAttribution = 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade',
    cloudmade = new L.TileLayer(cloudmadeUrl);

    mapbox = new L.TileLayer('http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-streets/{z}/{x}/{y}.png');

  // map.addLayer(cloudmade);
  map.addLayer(mapbox);
  map.fitWorld();

  var marker, markerLocation, i;
  if(gon) {

    for(i=0 ; i<gon.locations.length ; i++) {
      markerLocation = new L.LatLng(gon.locations[i].latitude, gon.locations[i].longitude);
      marker = new L.Marker(markerLocation);
      map.addLayer(marker);
      marker.bindPopup("<b>"+gon.locations[i].title+'</b><br /><a href="locations/'+gon.locations[i].id+'">Open</a>');

      // center with location
      if(gon.locations[i].id == gon.highloc) {
        var center = new L.LatLng(gon.locations[i].latitude, gon.locations[i].longitude);
        map.setView(center, 10, false);
        marker.openPopup(); 
      }
    }

    // define bounds for countries
    if(gon.south != null) {
      var southWest = new L.LatLng(gon.south, gon.west),
        northEast = new L.LatLng(gon.north, gon.east),
        bounds = new L.LatLngBounds(southWest, northEast);
      map.fitBounds(bounds);
    }
  }

</script>